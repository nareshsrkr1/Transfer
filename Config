#!/bin/bash

# Read configuration from config.ini
source_dir=$(awk -F '= ' '/\[input_files\]/{f=1; next} /\[.*\]/{f=0} f&&NF&&/source_dir/{print $NF}' config.ini)
destination_dir=$(awk -F '= ' '/\[input_files\]/{f=1; next} /\[.*\]/{f=0} f&&NF&&/destination_dir/{print $NF}' config.ini)
input_files=$(awk -F '= ' '/\[input_files\]/{f=1; next} /\[.*\]/{f=0} f&&NF&&/files/{print $NF}' config.ini)

# Ensure the destination directory exists
mkdir -p "$destination_dir"

# Get the current date and time
current_datetime=$(date +"%Y%m%d%H%M%S")

# Split input files into an array
IFS=',' read -ra input_files_array <<< "$input_files"

# Initialize an array to store matching files
declare -a matching_files_array

# Loop through each input file pattern
for input_file_pattern in "${input_files_array[@]}"; do
    # Find files matching the current pattern in the specified source directory
    matching_files=$(find "$source_dir" -maxdepth 1 -type f -name "$input_file_pattern" -print)
    matching_files_array+=($matching_files)
done

# Echo the matching files array
for file in "${matching_files_array[@]}"; do
    echo "$file"
done
