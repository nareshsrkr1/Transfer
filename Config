#!/bin/bash

# Read configuration from config.ini
source_dir=$(awk -F ' = ' '/\[directories\]/{f=1; next} /\[.*\]/{f=0} f&&NF&&/source_dir/{print $NF}' config.ini)
destination_dir=$(awk -F ' = ' '/\[directories\]/{f=1; next} /\[.*\]/{f=0} f&&NF&&/destination_dir/{print $NF}' config.ini)
input_files=$(awk -F '= ' '/\[input_files\]/{f=1; next} /\[.*\]/{f=0} f&&NF{print $NF}' config.ini)

# Ensure the destination directory exists
mkdir -p "$destination_dir"

# Iterate through .dat files specified in the configuration
for dat_file in $(echo "$input_files" | tr ',' '\n'); do
    # Construct the full path of the .dat file
    dat_file_path="$source_dir/$dat_file"

    # Check if the file exists
    if [ -e "$dat_file_path" ]; then
        # Get the base filename without extension
        base_filename=$(basename "$dat_file" .dat)

        # Zip the file
        zip "$destination_dir/$base_filename.zip" "$dat_file_path"

        # Tar and gzip the file
        tar -czf "$destination_dir/$base_filename.tar.gz" -C "$source_dir" "$dat_file"

        # Optionally, remove the original .dat file
        # rm "$dat_file_path"
    else
        echo "File '$dat_file' does not exist."
    fi
done

echo "Processing complete."
